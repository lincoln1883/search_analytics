<div class="container mx-auto p-8">
  <h1 class="text-2xl font-bold mb-4">Search Analytics</h1>

  <h2 class="text-xl font-semibold mt-6 mb-2">Top 20 Overall Searches</h2>
  <% if @top_searches.present? %>
    <ul class="list-disc pl-5">
      <% @top_searches.each do |query, count| %>
        <li class="mb-1"><span class="font-mono bg-gray-100 p-1 rounded"><%= query %></span> (<%= count %>)</li>
      <% end %>
    </ul>
  <% else %>
    <p class="text-gray-500">No search data yet.</p>
  <% end %>

  <h2 class="text-xl font-semibold mt-6 mb-2">Top 10 Searches Today</h2>
  <% if @top_searches_today.present? %>
    <ul class="list-disc pl-5">
      <% @top_searches_today.each do |query, count| %>
        <li class="mb-1"><span class="font-mono bg-gray-100 p-1 rounded"><%= query %></span> (<%= count %>)</li>
      <% end %>
    </ul>
  <% else %>
    <p class="text-gray-500">No search data from today yet.</p>
  <% end %>

  <h2 class="text-xl font-semibold mt-6 mb-2">Recent Individual Searches (Last Hour - Demo)</h2>
  <% if @recent_user_searches.present? %>
    <p class="text-sm text-red-600 mb-2">Warning: Displaying IPs for demonstration only. Anonymize in production.</p>
    <div class="space-y-2">
      <% @recent_user_searches.group_by(&:ip_address).each do |ip, searches| %>
        <div>
          <strong>User (IP: <%= ip %>):</strong>
          Latest search: <span class="font-mono bg-gray-100 p-1 rounded"><%= searches.first.final_query %></span>
          at <%= searches.first.timestamp.strftime('%Y-%m-%d %H:%M:%S') %>
        </div>
      <% end %>
    </div>
  <% else %>
    <p class="text-gray-500">No recent individual search data.</p>
  <% end %>

  <div class="mt-8">
    <%= link_to 'Back to Search', root_path, class: "text-blue-500 hover:underline" %>
  </div>
</div>
